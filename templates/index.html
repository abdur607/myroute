<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MyRoute — Fuel-Efficient Navigation</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Outfit:wght@300;400;500;600&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --blue-1: #78A2CC;
      --blue-3: #96B9D0;
      --blue-6: #BFD4DB;
      --paper:  #F4F1EC;
      --ink:    #1C2B3A;
      --ink-2:  #3A5068;
      --ink-3:  #6B8299;
      --rule:   #D8DFE6;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: var(--paper);
      color: var(--ink);
      font-family: 'Outfit', sans-serif;
      min-height: 100vh;
    }

    /* ── Full-page split ── */
    .shell {
      display: grid;
      grid-template-columns: 1fr 440px;
      min-height: 100vh;
    }

    /* ── Left side ── */
    .left {
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding: 80px 72px;
    }

    .wordmark {
      font-family: 'Playfair Display', serif;
      font-size: 15px;
      font-weight: 700;
      letter-spacing: 0.04em;
      color: var(--blue-1);
      margin-bottom: 64px;
    }

    .headline {
      font-family: 'Playfair Display', serif;
      font-size: clamp(40px, 4.2vw, 64px);
      font-weight: 700;
      line-height: 1.06;
      letter-spacing: -0.5px;
      margin-bottom: 24px;
    }
    .headline em {
      font-style: italic;
      color: var(--blue-1);
    }

    .subline {
      font-size: 16px;
      line-height: 1.7;
      color: var(--ink-3);
      font-weight: 300;
      max-width: 420px;
      margin-bottom: 72px;
    }

    /* Three simple stats — no boxes, just inline */
    .stats {
      display: flex;
      gap: 48px;
    }
    .stat-num {
      font-family: 'Playfair Display', serif;
      font-size: 28px;
      font-weight: 700;
      color: var(--blue-1);
      line-height: 1;
      margin-bottom: 4px;
    }
    .stat-label {
      font-family: 'Courier Prime', monospace;
      font-size: 10px;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--ink-3);
    }

    /* ── Right form side ── */
    .right {
      background: #fff;
      border-left: 1px solid var(--rule);
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding: 64px 48px;
    }

    .form-title {
      font-family: 'Playfair Display', serif;
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 8px;
    }
    .form-sub {
      font-size: 14px;
      color: var(--ink-3);
      margin-bottom: 40px;
      font-weight: 300;
    }

    /* ── Inputs ── */
    .field-label {
      font-family: 'Courier Prime', monospace;
      font-size: 10px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--ink-3);
      margin-bottom: 8px;
      display: block;
    }

    .field-row { margin-bottom: 20px; position: relative; }

    .field-wrap {
      position: relative;
      margin-bottom: 8px;
    }
    .field-wrap:last-child { margin-bottom: 0; }

    .field-prefix {
      position: absolute;
      left: 0; top: 0; bottom: 0;
      width: 40px;
      display: flex; align-items: center; justify-content: center;
      font-family: 'Courier Prime', monospace;
      font-size: 12px;
      color: var(--ink-3);
      border-right: 1px solid var(--rule);
      pointer-events: none;
      z-index: 2;
    }

    input, select {
      width: 100%;
      padding: 12px 14px 12px 50px;
      background: var(--paper);
      border: 1px solid var(--rule);
      color: var(--ink);
      font-family: 'Outfit', sans-serif;
      font-size: 14px;
      outline: none;
      border-radius: 0;
      -webkit-appearance: none;
      transition: border-color 0.15s;
    }
    input:focus, select:focus {
      border-color: var(--blue-1);
      background: #fff;
    }
    input::placeholder { color: var(--ink-3); font-weight: 300; }

    select {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M1 1l4 4 4-4' stroke='%236B8299' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 14px center;
      background-color: var(--paper);
      padding-right: 36px;
      cursor: pointer;
    }
    select:focus { background-color: #fff; }
    option { background: #fff; }

    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }

    /* Confirmed */
    .field-confirmed input { border-color: var(--blue-1); background: #f0f6fb; }
    .confirm-tick {
      display: none; position: absolute; right: 12px; top: 50%;
      transform: translateY(-50%);
      font-size: 13px; color: var(--blue-1); font-weight: 700; z-index: 3;
    }
    .field-confirmed .confirm-tick { display: block; }

    /* Autocomplete */
    .autocomplete-wrap { position: relative; }
    .ac-list {
      display: none; position: absolute; top: 100%; left: 0; right: 0; z-index: 9999;
      background: #fff; border: 1px solid var(--blue-3); border-top: none;
      list-style: none; max-height: 220px; overflow-y: auto;
      box-shadow: 0 8px 20px rgba(28,43,58,0.10);
    }
    .ac-list.open { display: block; }
    .ac-list li { padding: 10px 14px; cursor: pointer; border-bottom: 1px solid var(--rule); font-size: 13px; transition: background 0.1s; }
    .ac-list li:last-child { border-bottom: none; }
    .ac-list li:hover, .ac-list li.highlighted { background: #EEF4F9; }
    .ac-short { font-weight: 500; color: var(--ink); }
    .ac-full  { font-size: 11px; color: var(--ink-3); margin-top: 1px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

    /* Divider */
    .divider {
      height: 1px; background: var(--rule); margin: 24px 0;
    }

    /* Vehicle preview — just a quiet line, no box */
    .vehicle-preview { display: none; margin-top: 10px; }
    .vehicle-preview.show { display: flex; align-items: baseline; gap: 16px; }
    .vp-name { font-size: 13px; font-weight: 500; color: var(--ink-2); }
    .vp-specs { display: flex; gap: 12px; }
    .vp-spec { font-family: 'Courier Prime', monospace; font-size: 11px; color: var(--blue-1); }
    .vp-spec-label { color: var(--ink-3); }

    /* Driving style pills */
    .style-pills {
      display: flex;
      gap: 0;
      margin-bottom: 8px;
    }
    .style-pill {
      flex: 1;
      padding: 9px 0;
      text-align: center;
      border: 1px solid var(--rule);
      border-right: none;
      font-size: 13px;
      color: var(--ink-3);
      cursor: pointer;
      transition: background 0.12s, color 0.12s;
      user-select: none;
    }
    .style-pill:last-child { border-right: 1px solid var(--rule); }
    .style-pill input[type="radio"] { display: none; }
    .style-pill:has(input:checked),
    .style-pill.active {
      background: var(--ink);
      color: var(--paper);
      border-color: var(--ink);
    }
    .style-pill:has(input:checked) + .style-pill { border-left-color: var(--ink); }
    .style-note {
      font-family: 'Courier Prime', monospace;
      font-size: 10px;
      color: var(--ink-3);
      letter-spacing: 0.04em;
      margin-top: 2px;
    }

    /* Submit */
    .btn-submit {
      width: 100%; margin-top: 28px;
      padding: 14px 20px;
      background: var(--ink);
      color: var(--paper);
      border: none;
      font-family: 'Outfit', sans-serif;
      font-size: 15px; font-weight: 500;
      cursor: pointer;
      transition: background 0.15s;
      display: flex; align-items: center; justify-content: center; gap: 8px;
    }
    .btn-submit:hover { background: var(--blue-1); }
    .btn-submit.loading { opacity: 0.65; pointer-events: none; }
    .spinner { display: none; width: 14px; height: 14px; border: 2px solid rgba(244,241,236,0.3); border-top-color: #fff; border-radius: 50%; animation: spin 0.7s linear infinite; }
    .btn-submit.loading .btn-text { display: none; }
    .btn-submit.loading .spinner { display: block; }
    @keyframes spin { to { transform: rotate(360deg); } }

    .footnote { font-family: 'Courier Prime', monospace; font-size: 10px; letter-spacing: 0.05em; color: var(--ink-3); text-align: center; margin-top: 14px; }

    /* Responsive */
    @media (max-width: 900px) {
      .shell { grid-template-columns: 1fr; }
      .left { padding: 56px 32px 40px; }
      .right { border-left: none; border-top: 1px solid var(--rule); padding: 40px 32px 56px; }
      .stats { gap: 32px; }
    }
    @media (max-width: 480px) {
      .left { padding: 40px 24px 32px; }
      .right { padding: 32px 24px 48px; }
      .grid-2 { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
<div class="shell">

  <!-- Left -->
  <main class="left">
    <div class="wordmark">MyRoute</div>

    <h1 class="headline">
      Find the route<br>that burns <em>least.</em>
    </h1>

    <p class="subline">
      MyRoute uses your vehicle's aerodynamics, weight and engine efficiency to find
      the genuinely most fuel-efficient path — not just the fastest.
    </p>

    <div class="stats">
      <div>
        <div class="stat-num">40+</div>
        <div class="stat-label">Vehicles</div>
      </div>
      <div>
        <div class="stat-num">7×</div>
        <div class="stat-label">Routes scored</div>
      </div>
      <div>
        <div class="stat-num">3</div>
        <div class="stat-label">Physics forces</div>
      </div>
    </div>
  </main>

  <!-- Right form -->
  <aside class="right">
    <h2 class="form-title">Plan your journey</h2>
    <p class="form-sub">Enter your route and vehicle below.</p>

    <form id="routeForm" action="/results" method="GET">
      <input type="hidden" name="start_lat" id="start_lat">
      <input type="hidden" name="start_lon" id="start_lon">
      <input type="hidden" name="end_lat"   id="end_lat">
      <input type="hidden" name="end_lon"   id="end_lon">

      <div class="field-row">
        <span class="field-label">Route</span>
        <div class="autocomplete-wrap field-wrap" id="field-start">
          <div class="field-prefix">A</div>
          <input type="text" name="start" id="start" placeholder="Starting location" required autocomplete="off">
          <span class="confirm-tick">✓</span>
          <ul class="ac-list" id="ac-start"></ul>
        </div>
        <div class="autocomplete-wrap field-wrap" id="field-end">
          <div class="field-prefix">B</div>
          <input type="text" name="end" id="end" placeholder="Destination" required autocomplete="off">
          <span class="confirm-tick">✓</span>
          <ul class="ac-list" id="ac-end"></ul>
        </div>
      </div>

      <div class="divider"></div>

      <div class="field-row" style="margin-bottom: 0;">
        <span class="field-label">Vehicle</span>
        <div class="grid-2">
          <div class="field-wrap">
            <div class="field-prefix">▸</div>
            <select name="make" id="makeSelect" required>
              <option value="" disabled selected>Make</option>
              {% for make in makes %}
              <option value="{{ make }}">{{ make }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="field-wrap">
            <div class="field-prefix">▸</div>
            <select name="model" id="modelSelect" required>
              <option value="" disabled selected>Model</option>
            </select>
          </div>
        </div>
        <div class="vehicle-preview" id="vehiclePreview">
          <span class="vp-name" id="vpName"></span>
          <div class="vp-specs">
            <span class="vp-spec"><span class="vp-spec-label">Cd </span><span id="vpDrag"></span></span>
            <span class="vp-spec"><span class="vp-spec-label">eff </span><span id="vpEff"></span></span>
            <span class="vp-spec"><span class="vp-spec-label"></span><span id="vpWeight"></span><span class="vp-spec-label"> kg</span></span>
          </div>
        </div>
      </div>

      <div class="divider"></div>

      <div class="field-row" style="margin-bottom: 0;">
        <span class="field-label">Driving style</span>
        <div class="style-pills">
          <label class="style-pill">
            <input type="radio" name="style" value="calm"> Calm
          </label>
          <label class="style-pill active">
            <input type="radio" name="style" value="normal" checked> Normal
          </label>
          <label class="style-pill">
            <input type="radio" name="style" value="aggressive"> Aggressive
          </label>
        </div>
        <p class="style-note">Affects acceleration frequency and speed profile</p>
      </div>

      <button type="submit" class="btn-submit" id="submitBtn">
        <span class="btn-text">Calculate route →</span>
        <div class="spinner"></div>
      </button>
    </form>

    <p class="footnote">OpenRouteService · Nominatim</p>
  </aside>
</div>

<script>
function makeAutocomplete(cfg) {
  const input = document.getElementById(cfg.inputId);
  const list  = document.getElementById(cfg.listId);
  const latEl = document.getElementById(cfg.latId);
  const lonEl = document.getElementById(cfg.lonId);
  const field = document.getElementById(cfg.fieldId);
  let timer = null, suggestions = [], cursor = -1, locked = false;

  const openList  = () => list.classList.add('open');
  const closeList = () => { list.classList.remove('open'); cursor = -1; };

  function confirmLoc(lat, lon) { latEl.value = lat; lonEl.value = lon; locked = true; field.classList.add('field-confirmed'); }
  function clearLoc()            { latEl.value = ''; lonEl.value = ''; locked = false; field.classList.remove('field-confirmed'); }
  function highlight()           { Array.from(list.children).forEach((li,i) => li.classList.toggle('highlighted', i===cursor)); }

  function pick(i) {
    const s = suggestions[i]; if (!s) return;
    input.value = s.short; confirmLoc(s.lat, s.lon); closeList();
  }

  function render(items) {
    list.innerHTML = ''; cursor = -1;
    if (!items.length) { closeList(); return; }
    suggestions = items;
    items.forEach((s, i) => {
      const li = document.createElement('li');
      const full = s.display.length > 72 ? s.display.slice(0,72)+'…' : s.display;
      li.innerHTML = '<div class="ac-short">'+esc(s.short)+'</div><div class="ac-full">'+esc(full)+'</div>';
      li.addEventListener('mousedown', e => { e.preventDefault(); pick(i); });
      list.appendChild(li);
    });
    openList();
  }

  async function search(q) {
    try { const r = await fetch('/api/autocomplete?q='+encodeURIComponent(q)); render(await r.json()); }
    catch(e) {}
  }

  input.addEventListener('keydown', e => {
    if (!list.classList.contains('open')) return;
    if (e.key==='ArrowDown') { e.preventDefault(); cursor=Math.min(cursor+1,suggestions.length-1); highlight(); }
    else if (e.key==='ArrowUp') { e.preventDefault(); cursor=Math.max(cursor-1,0); highlight(); }
    else if (e.key==='Enter' && cursor>=0) { e.preventDefault(); pick(cursor); }
    else if (e.key==='Escape') closeList();
  });
  input.addEventListener('input', () => {
    clearLoc(); const q = input.value.trim(); clearTimeout(timer);
    if (q.length < 2) { closeList(); suggestions=[]; return; }
    timer = setTimeout(() => search(q), 300);
  });
  input.addEventListener('focus', () => { if (suggestions.length && !locked) openList(); });
  document.addEventListener('click', e => { if (!field.contains(e.target)) closeList(); });
}

function esc(s) { return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

makeAutocomplete({inputId:'start',listId:'ac-start',latId:'start_lat',lonId:'start_lon',fieldId:'field-start'});
makeAutocomplete({inputId:'end',  listId:'ac-end',  latId:'end_lat',  lonId:'end_lon',  fieldId:'field-end'});

const makeEl  = document.getElementById('makeSelect');
const modelEl = document.getElementById('modelSelect');
const preview = document.getElementById('vehiclePreview');

makeEl.addEventListener('change', async () => {
  modelEl.innerHTML = '<option value="" disabled selected>Loading…</option>';
  preview.classList.remove('show');
  const models = await (await fetch('/api/models?make='+encodeURIComponent(makeEl.value))).json();
  modelEl.innerHTML = '<option value="" disabled selected>Model</option>';
  models.forEach(m => { const o=document.createElement('option'); o.value=m; o.textContent=m; modelEl.appendChild(o); });
});

modelEl.addEventListener('change', async () => {
  const make=makeEl.value, model=modelEl.value; if (!make||!model) return;
  const data = await (await fetch('/api/cars')).json();
  const s = data[make]&&data[make][model]; if (!s) return;
  document.getElementById('vpName').textContent   = make+' '+model;
  document.getElementById('vpDrag').textContent   = s.drag_coefficient;
  document.getElementById('vpEff').textContent    = Math.round(s.efficiency*100)+'%';
  document.getElementById('vpWeight').textContent = s.weight;
  preview.classList.add('show');
});

document.getElementById('routeForm').addEventListener('submit', () => {
  document.getElementById('submitBtn').classList.add('loading');
});
</script>
</body>
</html>
